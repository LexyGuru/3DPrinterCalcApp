# 📋 版本发布说明 - 3DPrinterCalcApp

本文档包含 3D Printer Calculator 应用程序所有版本的详细更新日志。

---

## v2.0.0 (2025) - 🚀 性能监控 & 审计日志系统

### ⚡ 性能指标日志记录
- **性能计时器类** - 操作的手动计时
- **加载时间测量** - 记录所有模块加载时间（设置、打印机、耗材、报价、客户）
- **操作时间测量** - 异步和同步操作的自动计时
- **内存使用监控** - JavaScript 堆内存跟踪和日志记录
- **CPU 使用监控** - 每 5 分钟定期测量 CPU 使用情况
- **性能摘要** - 加载和操作时间的聚合统计
- **结构化日志消息** - 详细显示 CPU 百分比和内存值
- **后端性能命令** - 用于 CPU 和内存数据的后端命令 `get_performance_metrics`

### 🔐 审计日志实现
- **审计日志基础设施** - 单独的审计日志文件 (`audit-YYYY-MM-DD.json`)
- **关键操作日志记录**:
  - CRUD 操作（耗材、打印机、报价、客户的创建/更新/删除）
  - 设置更改（主题、语言、日志设置、自动保存等）
  - 备份操作（创建、恢复）
  - 恢复出厂设置操作
  - 错误记录
- **审计日志查看器** - 大文件的虚拟滚动，具有过滤、搜索和导出功能
- **自动清理** - 根据可配置的保留天数自动删除旧的审计日志文件
- **后端命令** - `write_audit_log`, `list_audit_logs`, `read_audit_log_file`, `delete_old_audit_logs`
- **完整本地化** - 所有 13 种支持的语言

### 🎯 UI/UX 改进
- **审计日志历史** - 设置 → 日志管理部分中的两列布局
- **性能指标显示** - 在系统诊断模态中
- **日志查看器实时更新** - 自动刷新切换，基于哈希的更改检测
- **自动滚动优化** - 用户滚动位置感知

### 🔧 技术改进
- **GitHub 更新检查优化** - 启动时和每 5 小时（基于 localStorage）
- **Beta 标签格式** - Beta 版本的单独 `beta-v2.0.0` 标签（不覆盖主版本）
- **版本检查器逻辑** - 基于 `beta-v` 前缀的 Beta 版本搜索

---

## v1.9.0 (2025) - 🔍 系统诊断 & 性能改进

### 🔍 系统诊断
- **全面的系统健康检查工具**:
  - 系统信息显示（CPU、内存、操作系统、GPU、磁盘）
  - 文件系统验证（data.json, filamentLibrary.json, update_filament.json）
  - 模块可用性检查（设置、报价、打印机、客户、计算器、主页）
  - 数据存储可用性检查
  - 带有详细状态消息的进度条
  - 带有错误/警告/成功状态的摘要
  - 重新运行按钮
- **移至日志管理部分**（更合理的放置）
- **完整本地化**（所有 13 种支持的语言）

### ⚡ 日志查看器性能
- **大日志文件的虚拟滚动**:
  - 日志查看器组件的自定义虚拟滚动实现
  - 仅渲染可见的日志条目，显著提高性能
  - 即使处理巨大的日志文件（100k+ 行）也能流畅滚动和搜索
  - 保持准确的滚动条位置和高度
  - 搜索和过滤操作明显更快

### 🔔 统一通知系统
- **中央通知服务**:
  - 单一的 `notificationService` 用于 Toast 和平台通知
  - 基于优先级的通知路由（高优先级 → 平台通知）
  - 基于应用程序状态（前台/后台）的自动决策
  - 与现有通知功能向后兼容
  - 可配置的通知设置（Toast 开/关，平台通知开/关，优先级级别）

### 🎯 UI/UX 改进
- 系统诊断从备份部分移至日志管理部分（更合理的放置）
- 修复了 TypeScript linter 错误（未使用的变量，类型差异）
- 改进了代码质量和可维护性

---

## v1.8.0 (2025) - 📊 高级日志系统 & 恢复出厂设置改进

### 🔄 恢复出厂设置进度模态
- **恢复出厂设置的可视进度指示器**:
  - 4 步动画进度（备份删除、日志删除、配置删除、完成）
  - 带有成功/错误消息的实时状态更新
  - 语言选择器显示前的 10 秒倒计时
  - 重置过程中无法关闭模态
  - 完整本地化（所有 13 种支持的语言）

### 📋 完整的日志系统改革
- **专业日志基础设施**:
  - 跨平台日志文件路径（特定于平台的数据目录）
  - 系统信息日志记录（CPU、内存、操作系统、GPU、磁盘、应用程序版本）
  - 目录信息日志记录（日志和备份文件夹、文件计数、大小）
  - 详细的加载状态日志记录（成功/警告/错误/严重）
  - 日志级别（DEBUG, INFO, WARN, ERROR）带过滤
  - 结构化日志格式支持（文本和 JSON）
  - 带自动清理的日志轮换（可配置的保留天数）
  - 带有过滤、搜索、高亮和导出的日志查看器模态
  - 设置中的日志配置（格式、级别、保留天数）
  - 应用程序重启时保留日志文件内容（追加模式）

### 🔍 系统诊断
- **系统健康检查模态**:
  - 系统信息显示和验证
  - 带警告的内存使用监控
  - 文件存在性检查
  - 模块可用性检查
  - 数据存储可用性测试
  - 进度条和摘要显示
  - 完整本地化（所有 13 种支持的语言）

### 🛠️ 技术改进
- 在恢复出厂设置期间禁用日志记录，以防止日志污染
- 将 data.json 创建延迟到语言选择（更清洁的恢复出厂设置过程）
- 将日志文件初始化延迟到语言选择
- 语言选择后自动重启应用程序
- 用于备份和日志文件管理的后端命令
- 备份和日志的跨平台路径处理
- 修复了内存计算（sysinfo 0.31 兼容性）
- 修复了 React 样式警告（CSS 简写冲突）

---

## v1.7.0 (2025) - 💾 备份系统、加载屏幕和耗材库改进

### 💾 完整的备份系统实现
- **自动备份系统** - 每天一个备份文件（仅在新的一天创建）
- **备份提醒钩子和 UI 组件** - 如果没有备份则通知
- **设置中的备份历史 UI** - 彩色编码列表（绿色/黄色/红色/灰色）用于备份文件年龄和删除倒计时
- **自动保存模态窗口** - 启用自动保存时的说明
- **自动保存和自动备份同步** - 自动保存保存时自动备份
- **带自动备份文件删除的恢复出厂设置**
- **自动保存启用时自动刷新备份历史**

### 🔧 备份系统后端优化
- **添加后端命令**以删除旧备份 (`cleanup_old_backups_by_days`, `cleanup_old_backups_by_count`)
- **前端清理功能更新为使用后端命令**，消除"禁止路径"错误
- **所有文件操作（创建、删除、列出）现在都从后端进行**，避免 Tauri 权限问题

### ⚡ 备份系统性能优化
- `hasTodayBackup()` 优化：使用后端命令 `list_backup_files`，无需读取所有文件
- **添加锁定机制**以防止并行备份
- **即使有大量备份文件也能更快操作**

### 📁 备份目录打开和日志历史
- **添加按钮**在设置 → 备份历史部分打开备份文件夹
- **设置中的新日志历史部分** - 列出并打开日志文件
- **可配置的日志文件自动删除**（按天）
- **跨平台支持**（macOS、Windows、Linux）

### 🎨 完整的加载屏幕改革
- **应用程序徽标集成**为背景，带玻璃态效果
- **标记的固定布局** - 自动滚动，一次仅显示 3 个模块
- **闪烁效果、脉冲点动画**
- **带隐藏滚动条的滚动容器**

### ⚙️ 加载过程改进
- **减慢加载**（800ms 延迟） - 加载消息可读
- **所有模块的错误处理**（try-catch 块）
- **所有状态和错误的物理日志文件**
- **最后的加载摘要**

### 🎨 耗材库多语言支持
- **耗材颜色显示**在所有支持的语言中（不仅仅是匈牙利语/德语/英语）
- **回退逻辑**：英语 → 匈牙利语 → 德语 → 原始颜色/名称
- 更新了设置、全局搜索和耗材组件

### 🔄 恢复出厂设置改进
- **物理文件删除** (`data.json`, `filamentLibrary.json`, `update_filamentLibrary.json`)
- **存储实例重置**无需重新加载
- **恢复出厂设置后显示语言选择器**

### 🎓 使用 v1.7.0 新功能更新教程
- 新步骤：widget-interactivity, table-sorting, autosave-backup, filament-library-multilang
- 扩展演示数据：6 个耗材 → 11 个耗材，3 个报价 → 5 个报价
- 为所有语言添加翻译键

---

## v1.6.0 (2025) - 📊 交互式小部件 & 大表格性能调整

### 🧠 交互式图表和详细模态视图
- **主仪表板图表使用统一的 `InteractiveChart` 组件**，带有可点击的数据点和动画详细模态视图
- **工具提示和详细视图已本地化**，显示人类可读的标签（收入、成本、净利润、报价数量）
- **时间周期可以直接从趋势图设置**（每周/每月/每年）使用画笔，切片数据流向主页 → 仪表板

### 🧵 大列表的虚拟滚动
- **报价列表和耗材表的自定义虚拟滚动** - 仅渲染可见行，即使有 10k+ 记录也能确保流畅滚动
- **设置 → 耗材库**使用相同模式，保持完整的 12,000+ 颜色调色板响应式
- **滚动条位置/高度保持正确**，这要归功于可见范围上方和下方的间隔元素

### 📋 高级表格排序和过滤
- **耗材和报价页面上的多列排序**（点击：升序/降序，Shift+点击：构建排序链 - 例如，"品牌 ↑，然后价格/公斤 ↓"）
- **排序设置保存在 `settings` 中**，因此首选顺序在重启后保持不变
- **耗材**：品牌、材料/类型和颜色/HEX 值的列级过滤器
- **报价**：带最小/最大值的金额过滤器和日期范围过滤器（从/到）

---

**最后更新**：2025 年 12 月 1 日


