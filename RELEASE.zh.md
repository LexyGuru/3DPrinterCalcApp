# 📋 版本发布说明 - 3DPrinterCalcApp

本文档包含 3D Printer Calculator 应用程序所有版本的详细更新日志。

---

## v3.0.3 (2025) - 🔧 热修复：客户数据加密修复和UI改进

### 🐛 错误修复

#### 客户数据加密修复
- **报价操作对加密数据禁用** - 如果客户数据已加密且未提供密码，报价编辑、复制和状态更改现已禁用
- **重复键问题已修复** - 报价列表和状态历史中不再出现"Encountered two children with the same key"错误
- **报价计数器修复** - 客户报价计数器现在也按`customerId`计数，不仅按名称，与加密数据正确配合工作
- **输入密码后更新报价** - 当提供密码并解密客户时，报价中的客户名称会恢复，而不是"加密数据"
- **状态历史列表** - 状态历史列表现在仅显示客户ID，不显示客户名称，即使在输入密码后也是如此（符合加密要求）

#### Toast消息改进
- **防止重复的toast消息** - Toast消息现在只出现一次，即使被多次调用
- **点击按钮时关闭toast** - 点击toast消息中的"输入密码"按钮时，toast会自动关闭
- **Toast消息重新设计** - Toast消息现在具有更干净、更专业的外观，操作按钮采用列布局

#### 添加的翻译键
- **新的翻译键** - 已添加到所有13种语言：
  - `encryption.passwordRequired` - "需要加密密码"
  - `encryption.passwordRequiredForOfferEdit` - "需要加密密码才能编辑报价"
  - `encryption.passwordRequiredForOfferDuplicate` - "需要加密密码才能复制报价"
  - `encryption.passwordRequiredForOfferStatusChange` - "需要加密密码才能更改报价状态"
  - `encryption.passwordRequiredForCustomerCreate` - "需要加密密码才能创建新客户"
  - `encryption.passwordRequiredForCustomerEdit` - "需要加密密码才能编辑"
  - `encryption.encryptedData` - "加密数据"
  - `customers.id` - "客户ID"
  - `customers.encryptedDataMessage` - "🔒 加密数据 - 需要密码才能查看"

### 📝 技术细节

- **版本已更新**: `Cargo.toml`, `tauri.conf.json`, `frontend/src/utils/version.ts` → `3.0.3`
- **硬编码字符串已替换**: 所有硬编码的匈牙利语字符串已替换为翻译键
- **TypeScript类型已更新**: 新翻译键已添加到`TranslationKey`类型
- **Toast Provider已修改**: 已添加重复toast检查和自动关闭
- **报价更新逻辑**: 提供密码后解密客户时自动更新报价

---

## v3.0.2 (2025) - 🔧 热修复：教程修复、权限、工厂重置日志记录

### 🐛 错误修复

#### 教程修复
- **教程数据保留** - 如果教程已经运行过一次，现有数据不会再次删除
- **教程扩展到18步** - 添加：项目、任务、日历、备份/恢复步骤
- **教程翻译键** - 缺失的翻译键已添加到所有语言文件

#### 权限修复
- **customers.json 权限** - 已添加删除 `customers.json` 文件所需的权限

#### 工厂重置日志记录
- **后端日志文件写入** - 工厂重置步骤现在记录到后端日志文件
- **详细日志记录** - 每个工厂重置步骤都详细记录
- **后端日志删除已恢复** - 后端日志文件现在在工厂重置期间被删除

### 📝 技术细节

- **版本已更新**：`Cargo.toml`、`tauri.conf.json`、`frontend/src/utils/version.ts` → `3.0.2`

---

## v3.0.0 (2025) - 🔒 客户数据加密 & GDPR 合规性 + ⚡ 性能优化

### ⚡ 性能优化和代码分割

#### React.lazy() 文档和优化
- **React.lazy() 实现文档** - 创建完整文档 (`docs/PERFORMANCE.md`)
- **加载阶段优化** - 加载阶段仅加载数据，组件按需加载
- **Suspense fallback 优化** - AppRouter.tsx 中的优化 fallback 组件
- **添加错误边界** - LazyErrorBoundary.tsx 组件用于懒加载组件

#### 基于路由的代码分割
- **React Router 集成** - 安装并配置 React Router v7.10.0
- **基于 URL 的导航** - 实现路由结构 (`/settings`, `/offers`, `/customers`, 等)
- **路由懒加载** - 每个路由自动分割为单独文件
- **State-based → Routing 转换** - `activePage` 状态转换为基于 URL 的路由
- **可收藏页面** - 所有页面可通过直接 URL 访问
- **浏览器导航支持** - 前进/后退按钮可用，更好的用户体验

#### 代码分割精细调整
- **Vite 构建配置优化** - 配置 `rollupOptions.output.manualChunks`
- **Vendor chunk 优化**:
  - React/React-DOM/React-Router 独立 chunk (`vendor-react`)
  - Tauri API 独立 chunk (`vendor-tauri`)
  - UI 库独立 chunks (`vendor-ui-framer`, `vendor-ui-charts`)
  - 其他 node_modules (`vendor`)
- **基于路由的 chunking** - 自动懒加载为每个路由创建独立 chunks
- **Router 文件分组** - 组织为 `router`, `routes` chunks
- **共享组件分组** - `components-shared` chunk
- **Chunk 大小警告限制** - 设置为 1000 KB

#### 模块化架构
- **模块化架构文档** - 完整文档 (`docs/MODULAR_ARCHITECTURE.md`)
- **路径别名** - 配置 `@features`, `@shared`, `@core` 别名
- **Vite 和 TypeScript 配置** - 更新路径别名支持
- **共享模块实现**:
  - 共享组件 (ConfirmDialog, FormField, InputField, SelectField, NumberField)
  - 共享 Hooks (useModal, useForm)
  - 共享工具 (debounce, format, validation)
- **功能模块重构** - 完整重构 6 个模块:
  - Calculator: 582 行 → 309 行 (-46.9%)
  - Settings: 5947 行 → 897 行 (-85%!)
  - Offers: 3985 行 → 3729 行 (-6.4%)
  - Home: 3454 行 → 3308 行 (-4.2%)
  - Filaments 和 Printers 模块也已重构

### 🔒 客户数据加密
- **AES-256-GCM 加密** - 使用行业标准 AES-256-GCM 算法加密存储客户数据
- **PBKDF2 密码哈希** - 使用 PBKDF2 算法（100,000 次迭代，SHA-256）安全存储密码
- **单独文件存储** - 加密的客户数据存储在单独的 `customers.json` 文件中
- **内存密码管理** - 密码仅存储在内存中，应用关闭时删除
- **应用密码集成** - 可选：应用密码保护的密码也可用于加密
- **密码提示系统** - 智能密码请求（不在加载屏幕上显示，在欢迎消息之后）
- **数据完整性保护** - 加密数据防止意外删除

### ✅ 符合 GDPR/欧盟 数据保护
- **合规性**：应用程序按照 GDPR（通用数据保护条例）和欧盟数据保护法规处理客户数据
- **行业标准加密**：使用 AES-256-GCM 算法（符合欧盟建议）
- **安全密码管理**：PBKDF2 哈希算法（NIST 推荐）
- **最小数据收集**：仅存储应用程序所需的客户数据
- **数据保留**：用户对数据存储和删除拥有完全控制权
- **访问控制**：对客户数据的密码保护访问

### 🎨 UI/UX 改进
- **加密激活模态框** - 新的模态对话框用于激活加密，带有应用密码选项
- **ConfirmDialog 增强** - 对模态组件的自定义内容支持
- **密码提示时序** - 智能显示（不在加载屏幕上）
- **设置集成** - 安全标签页中的加密设置

### 🔧 技术改进
- **后端加密模块** - 在 Rust 中实现的加密 (`src-tauri/src/encryption.rs`)
- **前端加密工具** - 用于加密管理的 TypeScript 工具函数
- **密码管理器** - 内存密码管理系统
- **存储集成** - saveCustomers/loadCustomers 函数与加密集成

### 📚 语言支持
- **13 种语言已更新** - 所有语言文件中都有新的加密翻译键
- **新键**：`encryption.enableEncryption`, `encryption.useSamePasswordAsApp`, `encryption.encryptionPassword`, `encryption.passwordMinLength`

---

## v2.0.0 (2025) - 🚀 性能监控 & 审计日志系统

### 🌐 控制台消息本地化
- **完全控制台本地化** - 所有控制台消息以所选语言显示
- **存储操作翻译** - 加载和保存消息（打印机、耗材、设置、报价、客户、项目、任务）
- **备份消息翻译** - 每日备份检查、备份创建、轮换消息
- **日志轮换消息翻译** - 日志和审计日志轮换消息（包含动态部分）
- **性能指标翻译** - CPU和内存指标、定期日志消息
- **系统消息翻译** - 应用程序初始化、前端日志初始化、欢迎消息
- **多部分消息翻译** - 控制台消息数据部分的翻译（日期、时间戳、文件、状态信息）
- **支持13种语言** - 所有控制台消息已翻译为英语、匈牙利语、德语、西班牙语、意大利语、波兰语、葡萄牙语、俄语、乌克兰语、捷克语、斯洛伐克语和中文

### ⚡ 性能指标日志记录
- **性能计时器类** - 操作的手动计时
- **加载时间测量** - 记录所有模块加载时间（设置、打印机、耗材、报价、客户）
- **操作时间测量** - 异步和同步操作的自动计时
- **内存使用监控** - JavaScript 堆内存跟踪和日志记录
- **CPU 使用监控** - 每 5 分钟定期测量 CPU 使用情况
- **性能摘要** - 加载和操作时间的聚合统计
- **结构化日志消息** - 详细显示 CPU 百分比和内存值
- **后端性能命令** - 用于 CPU 和内存数据的后端命令 `get_performance_metrics`

### 🔐 审计日志实现
- **审计日志基础设施** - 单独的审计日志文件 (`audit-YYYY-MM-DD.json`)
- **关键操作日志记录**:
  - CRUD 操作（耗材、打印机、报价、客户的创建/更新/删除）
  - 设置更改（主题、语言、日志设置、自动保存等）
  - 备份操作（创建、恢复）
  - 恢复出厂设置操作
  - 错误记录
- **审计日志查看器** - 大文件的虚拟滚动，具有过滤、搜索和导出功能
- **自动清理** - 根据可配置的保留天数自动删除旧的审计日志文件
- **后端命令** - `write_audit_log`, `list_audit_logs`, `read_audit_log_file`, `delete_old_audit_logs`
- **完整本地化** - 所有 13 种支持的语言

### 🎯 UI/UX 改进
- **审计日志历史** - 设置 → 日志管理部分中的两列布局
- **性能指标显示** - 在系统诊断模态中
- **日志查看器实时更新** - 自动刷新切换，基于哈希的更改检测
- **自动滚动优化** - 用户滚动位置感知

### 🔧 技术改进
- **GitHub 更新检查优化** - 启动时和每 5 小时（基于 localStorage）
- **Beta 标签格式** - Beta 版本的单独 `beta-v2.0.0` 标签（不覆盖主版本）
- **版本检查器逻辑** - 基于 `beta-v` 前缀的 Beta 版本搜索

---

## v1.9.0 (2025) - 🔍 系统诊断 & 性能改进

### 🔍 系统诊断
- **全面的系统健康检查工具**:
  - 系统信息显示（CPU、内存、操作系统、GPU、磁盘）
  - 文件系统验证（data.json, filamentLibrary.json, update_filament.json）
  - 模块可用性检查（设置、报价、打印机、客户、计算器、主页）
  - 数据存储可用性检查
  - 带有详细状态消息的进度条
  - 带有错误/警告/成功状态的摘要
  - 重新运行按钮
- **移至日志管理部分**（更合理的放置）
- **完整本地化**（所有 13 种支持的语言）

### ⚡ 日志查看器性能
- **大日志文件的虚拟滚动**:
  - 日志查看器组件的自定义虚拟滚动实现
  - 仅渲染可见的日志条目，显著提高性能
  - 即使处理巨大的日志文件（100k+ 行）也能流畅滚动和搜索
  - 保持准确的滚动条位置和高度
  - 搜索和过滤操作明显更快

### 🔔 统一通知系统
- **中央通知服务**:
  - 单一的 `notificationService` 用于 Toast 和平台通知
  - 基于优先级的通知路由（高优先级 → 平台通知）
  - 基于应用程序状态（前台/后台）的自动决策
  - 与现有通知功能向后兼容
  - 可配置的通知设置（Toast 开/关，平台通知开/关，优先级级别）

### 🎯 UI/UX 改进
- 系统诊断从备份部分移至日志管理部分（更合理的放置）
- 修复了 TypeScript linter 错误（未使用的变量，类型差异）
- 改进了代码质量和可维护性

---

## v1.8.0 (2025) - 📊 高级日志系统 & 恢复出厂设置改进

### 🔄 恢复出厂设置进度模态
- **恢复出厂设置的可视进度指示器**:
  - 4 步动画进度（备份删除、日志删除、配置删除、完成）
  - 带有成功/错误消息的实时状态更新
  - 语言选择器显示前的 10 秒倒计时
  - 重置过程中无法关闭模态
  - 完整本地化（所有 13 种支持的语言）

### 📋 完整的日志系统改革
- **专业日志基础设施**:
  - 跨平台日志文件路径（特定于平台的数据目录）
  - 系统信息日志记录（CPU、内存、操作系统、GPU、磁盘、应用程序版本）
  - 目录信息日志记录（日志和备份文件夹、文件计数、大小）
  - 详细的加载状态日志记录（成功/警告/错误/严重）
  - 日志级别（DEBUG, INFO, WARN, ERROR）带过滤
  - 结构化日志格式支持（文本和 JSON）
  - 带自动清理的日志轮换（可配置的保留天数）
  - 带有过滤、搜索、高亮和导出的日志查看器模态
  - 设置中的日志配置（格式、级别、保留天数）
  - 应用程序重启时保留日志文件内容（追加模式）

### 🔍 系统诊断
- **系统健康检查模态**:
  - 系统信息显示和验证
  - 带警告的内存使用监控
  - 文件存在性检查
  - 模块可用性检查
  - 数据存储可用性测试
  - 进度条和摘要显示
  - 完整本地化（所有 13 种支持的语言）

### 🛠️ 技术改进
- 在恢复出厂设置期间禁用日志记录，以防止日志污染
- 将 data.json 创建延迟到语言选择（更清洁的恢复出厂设置过程）
- 将日志文件初始化延迟到语言选择
- 语言选择后自动重启应用程序
- 用于备份和日志文件管理的后端命令
- 备份和日志的跨平台路径处理
- 修复了内存计算（sysinfo 0.31 兼容性）
- 修复了 React 样式警告（CSS 简写冲突）

---

## v1.7.0 (2025) - 💾 备份系统、加载屏幕和耗材库改进

### 💾 完整的备份系统实现
- **自动备份系统** - 每天一个备份文件（仅在新的一天创建）
- **备份提醒钩子和 UI 组件** - 如果没有备份则通知
- **设置中的备份历史 UI** - 彩色编码列表（绿色/黄色/红色/灰色）用于备份文件年龄和删除倒计时
- **自动保存模态窗口** - 启用自动保存时的说明
- **自动保存和自动备份同步** - 自动保存保存时自动备份
- **带自动备份文件删除的恢复出厂设置**
- **自动保存启用时自动刷新备份历史**

### 🔧 备份系统后端优化
- **添加后端命令**以删除旧备份 (`cleanup_old_backups_by_days`, `cleanup_old_backups_by_count`)
- **前端清理功能更新为使用后端命令**，消除"禁止路径"错误
- **所有文件操作（创建、删除、列出）现在都从后端进行**，避免 Tauri 权限问题

### ⚡ 备份系统性能优化
- `hasTodayBackup()` 优化：使用后端命令 `list_backup_files`，无需读取所有文件
- **添加锁定机制**以防止并行备份
- **即使有大量备份文件也能更快操作**

### 📁 备份目录打开和日志历史
- **添加按钮**在设置 → 备份历史部分打开备份文件夹
- **设置中的新日志历史部分** - 列出并打开日志文件
- **可配置的日志文件自动删除**（按天）
- **跨平台支持**（macOS、Windows、Linux）

### 🎨 完整的加载屏幕改革
- **应用程序徽标集成**为背景，带玻璃态效果
- **标记的固定布局** - 自动滚动，一次仅显示 3 个模块
- **闪烁效果、脉冲点动画**
- **带隐藏滚动条的滚动容器**

### ⚙️ 加载过程改进
- **减慢加载**（800ms 延迟） - 加载消息可读
- **所有模块的错误处理**（try-catch 块）
- **所有状态和错误的物理日志文件**
- **最后的加载摘要**

### 🎨 耗材库多语言支持
- **耗材颜色显示**在所有支持的语言中（不仅仅是匈牙利语/德语/英语）
- **回退逻辑**：英语 → 匈牙利语 → 德语 → 原始颜色/名称
- 更新了设置、全局搜索和耗材组件

### 🔄 恢复出厂设置改进
- **物理文件删除** (`data.json`, `filamentLibrary.json`, `update_filamentLibrary.json`)
- **存储实例重置**无需重新加载
- **恢复出厂设置后显示语言选择器**

### 🎓 使用 v1.7.0 新功能更新教程
- 新步骤：widget-interactivity, table-sorting, autosave-backup, filament-library-multilang
- 扩展演示数据：6 个耗材 → 11 个耗材，3 个报价 → 5 个报价
- 为所有语言添加翻译键

---

## v1.6.0 (2025) - 📊 交互式小部件 & 大表格性能调整

### 🧠 交互式图表和详细模态视图
- **主仪表板图表使用统一的 `InteractiveChart` 组件**，带有可点击的数据点和动画详细模态视图
- **工具提示和详细视图已本地化**，显示人类可读的标签（收入、成本、净利润、报价数量）
- **时间周期可以直接从趋势图设置**（每周/每月/每年）使用画笔，切片数据流向主页 → 仪表板

### 🧵 大列表的虚拟滚动
- **报价列表和耗材表的自定义虚拟滚动** - 仅渲染可见行，即使有 10k+ 记录也能确保流畅滚动
- **设置 → 耗材库**使用相同模式，保持完整的 12,000+ 颜色调色板响应式
- **滚动条位置/高度保持正确**，这要归功于可见范围上方和下方的间隔元素

### 📋 高级表格排序和过滤
- **耗材和报价页面上的多列排序**（点击：升序/降序，Shift+点击：构建排序链 - 例如，"品牌 ↑，然后价格/公斤 ↓"）
- **排序设置保存在 `settings` 中**，因此首选顺序在重启后保持不变
- **耗材**：品牌、材料/类型和颜色/HEX 值的列级过滤器
- **报价**：带最小/最大值的金额过滤器和日期范围过滤器（从/到）

---

**最后更新**：2025 年 12 月 1 日


